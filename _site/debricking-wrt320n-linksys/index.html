<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">

  <title>debricking router linksys wrt320n</title>

  <meta name="author" content="mario" />

  

  <link rel="alternate" type="application/rss+xml" title="manton - thoughts, experience and hobbies" href="/feed.xml" />

  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-29706858-5"></script>
    <script>
          window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-29706858-5');
</script>


  

  
<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-29706858-5', 'auto');
    ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



  
    
      
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />


    
  

  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="debricking router linksys wrt320n" />
  

   
  <meta property="og:description" content="I was messing around with my home network these days of lockdown and decided to use OpenVPn integrated within DD-WRT that was flashed to my Linksys wrt320N ages ago. The openvpn it came with had to be reasonable old so i decided to give it whirl and upgrade the firmware....">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://localhost:4000/debricking-wrt320n-linksys/" />
  <link rel="canonical" href="http://localhost:4000/debricking-wrt320n-linksys/" />
  

  
  <meta property="og:image" content="http://localhost:4000/img/avatar-icon.png" />
  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />

  
  <meta name="twitter:title" content="debricking router linksys wrt320n" />
  

  
  <meta name="twitter:description" content="I was messing around with my home network these days of lockdown and decided to use OpenVPn integrated within DD-WRT that was flashed to my Linksys wrt320N ages ago. The openvpn it came with had to be reasonable old so i decided to give it whirl and upgrade the firmware....">
  

  
  <meta name="twitter:image" content="http://localhost:4000/img/avatar-icon.png" />
  

  

  

</head>


  <body>

    

  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand" href="http://localhost:4000">manton</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            






<a href="/meeeeeh">About Me</a>

          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Resources</a>
            <div class="navlinks-children">
              
                
                  






<a href="http://www.markdowntutorial.com/">Learn markdown</a>

                
              
                
                  






<a href="https://pages.github.com/">GitHub Pages</a>

                
              
                
                  






<a href="https://redis.io/documentation">Redis</a>

                
              
            </div>
          </li>
        
        
      </ul>
    </div>

	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://localhost:4000">
	      <img class="avatar-img" src="/img/router.png" />
		</a>
	  </div>
	</div>
	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>debricking router linksys wrt320n</h1>
		  
		  
		  
		  <span class="post-meta">Posted on April 17, 2020</span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

      

      <article role="main" class="blog-post">
        <p>I was messing around with my home network these days of lockdown and decided to use OpenVPn integrated within DD-WRT that was flashed to my Linksys wrt320N ages ago. The openvpn it came with had to be  reasonable old so i decided to give it whirl and upgrade the firmware. 
Firmware for upgrades can be found in here <a href="https://dd-wrt.com/support/router-database/?model=WRT320N_v1.0">Router Database</a></p>

<p>That is how i ended up bricking my router. I went for the image <code class="highlighter-rouge">DD-WRT Broadcom Generic - NEWD K2.6 - Mega </code> instead of <code class="highlighter-rouge">DD-WRT Broadcom Generic - NEWD K2.6 - Mini</code></p>

<p>Instead of throwing the router to the bin i decided to spend some money and time and invenstigate how this was achievable.</p>

<p>First of all checked whether this router had capabilities for me to flash a new firmware. Yes, it is possible and apparently can be done via 2 ways.</p>

<blockquote>
  <p>The router has a Broadcom chipset and comes with CFE <a href="https://en.wikipedia.org/wiki/Common_Firmware_Environment">Common Firmware Environment</a>. This enables you to do the first method</p>
</blockquote>

<h4 id="method-30-30-30">Method 30-30-30:</h4>
<ul>
  <li>This method is going to trigger flashing of firmware that is living in the tftp/nvram if it was in there previously. It does trigger this in the background: ` flash -ctheader : flash1.trx`. This basically reads a bin file with the flash image. It is worth trying.</li>
  <li>To run this, you need to press the WPS button continuosly at the time you are switching on your router. Unfortunately this did not work for me.</li>
</ul>

<h4 id="manual-method">Manual method:</h4>

<blockquote>
  <p>We will need:</p>
  <ul>
    <li>USB to SERIAL UART. <a href="https://www.amazon.co.uk/gp/product/B072K3Z3TL/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">AMAZON</a>. This one works pretty well and comes with output voltage of 3.3 and 5.5. I know, i can do this with a raspberrypi as well.</li>
    <li>Ethernet RJ45 cable, with usb convertor to ethernet for your laptop if you don’t have interface for it.</li>
    <li>Soldering Kit</li>
    <li>TFTP client</li>
  </ul>
</blockquote>

<p><code class="highlighter-rouge">Firts things first</code></p>

<p>Linksys wrt320n comes with two ways to reach serial comm.</p>
<ul>
  <li>Using the WAN port and home made interface which i ruled out. If you look closely in the WAN port of your router you will see the RX, TX, GND, and 3.3v pins.</li>
  <li>Using the serial interfaces avaialble in the router motherboard. This method is easier since soldering is pretty accurate.</li>
</ul>

<p>Serial interface available in the router motherboard:</p>

<p><img src="https://github.com/marioanton/marioanton.github.io/raw/master/img/pins.png" alt="" title="router serial comm pins interface" /></p>

<p>You can see already the mapping of the pins for the serial interface and also can see where you can find the otehr pins in the WAN interface, where serial is possible to be done as well.</p>

<p>We DON’T need to connect 3.3v. Don’t do it and you will not put your router in risk. We weill be using normal router power source.</p>

<blockquote>
  <p>Don’t have to say that you have to open the router. In the process of opening up your router you will have to remove 3 wires connected to the motherboard. They are antenna ones.</p>
</blockquote>

<p>Once opened, solder this as the image states. The soldering wires for TX and RX should be linked to the opposite ones in the USB to serial adapter UART. So, for example TX should go with RX and RX with TX.</p>

<p><code class="highlighter-rouge">Using iterm2 as console to comm with the serial port</code></p>

<p>I use a MACos Catalina and i did not want to install any extra software since i got already Iterm2.
Create a new profile and specify a command there for whenever the session with this profile is opened.</p>

<p>screen /dev/cu.usbserial-0001 115200</p>

<p><img src="https://github.com/marioanton/marioanton.github.io/raw/master/img/iterm.png" alt="" title="iterm config profile" /></p>
<blockquote>
  <p>You will have to replace the device accordingly with the name of your UART usb to serial HW. Can figure this out by running:</p>
</blockquote>

<p>ls /dev/ |  grep cu.usbserial</p>

<p><code class="highlighter-rouge">Connect ethernet cable</code></p>

<p>Apart from connecting the cable to the laptop and router you will have to accomodate an ip like 192.168.1.3 and mask /24 not to clash with router IP that will be in place once switched on (192.168.1.1).</p>

<p>This has to be done on your laptop, in the network ethernet interface tied to the cable plugged in.</p>

<p><code class="highlighter-rouge">Debricking your router</code></p>

<p>Once soldering is done, profile is configured and cables are connected, we can start proceding with the debricking of the router wrt320n.</p>

<p>First Stage. Connecting to the router.</p>

<ol>
  <li>Switch everything off.</li>
  <li>Connect USB to SERIAL device to your laptop. This should be connected with the route motheraboard serial interface.</li>
  <li>Connect ethernet cable.</li>
  <li>Press CTRL-C and hold that on while you switch on your router.</li>
</ol>

<p>You should be seeing something like:
<img src="https://github.com/marioanton/marioanton.github.io/raw/master/img/boot.png" alt="" title="boot" /></p>

<p>Second Stage. Erasing NVRAM</p>

<ol>
  <li>Run command: erase nvram</li>
  <li>Run command: reboot and hold CTRL-C while rebooting.</li>
</ol>

<p>Third Stage. Flashing.</p>

<ol>
  <li>Open a console and get located in the folder where the binary lives</li>
  <li>run this command: tftp 192.168.1.1</li>
  <li>run this command within tftp console: binary</li>
  <li>run this command within serial console:  flash -ctheader : flash1.trx</li>
  <li>run this command within tftp console:  put image.bin image.bin</li>
  <li>run this command within serial console: reboot</li>
</ol>

<p>You should be seeing some like this:</p>

<p><img src="https://github.com/marioanton/marioanton.github.io/raw/master/img/tftp.png" alt="" title="tftp" /></p>

<p>There are some errrors in this screenshot because:</p>
<ul>
  <li>Image was incorrect one (CODE pattern Invalid error)</li>
  <li>Ethernet cable not connected / Router not switched on but in the end you can see image being uploaded correctly.</li>
</ul>

<p>On this way, you have achieved to get the router back to life with a DD-WRT original image for this router and with all functionality. 
Switch it off and on to verify everything works as expected and restore your config and reset your password again :)</p>

<p>Hope you enjoyed it and got your wrt320n back to life. :)</p>

      </article>

      
        <div class="blog-tags">
          Tags:
          
          
            <a href="/tags#wrt320">wrt320</a>
          
            <a href="/tags#bricked">bricked</a>
          
          
        </div>
      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
  <!--- Share on Twitter -->
    <a href="https://twitter.com/intent/tweet?text=debricking+router+linksys+wrt320n+http://localhost:4000/debricking-wrt320n-linksys/"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fa fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
  <!--- Share on Facebook -->
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/debricking-wrt320n-linksys/"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fa fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
  <!--- Share on LinkedIn -->
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/debricking-wrt320n-linksys/"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fa fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

</section>



      

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/redis-sentinel-thoughts/" data-toggle="tooltip" data-placement="top" title="redis & sentinel thoughts after some doc reading">&larr; Previous Post</a>
        </li>
        
        
      </ul>

      
        <div class="disqus-comments">
          
        </div>
          
        <div class="staticman-comments">
          

        </div>
        <div class="justcomments-comments">
          
        </div>
      
    </div>
  </div>
</div>


    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links"><li><a href="/feed.xml" title="RSS"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">RSS</span>
              </a>
            </li><li><a href="mailto:contacto@marioanton.com" title="Email me"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Email me</span>
              </a>
            </li><li><a href="https://github.com/marioanton" title="GitHub"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">GitHub</span>
              </a>
            </li><li><a href="https://twitter.com/merioanten" title="Twitter"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Twitter</span>
              </a>
            </li><li><a href="https://linkedin.com/in/marioanton" title="LinkedIn"><span class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">LinkedIn</span>
              </a>
            </li></ul>
      <p class="copyright text-muted">
      mario
      &nbsp;&bull;&nbsp;
      2020

      
      &nbsp;&bull;&nbsp;
      <a href="http://localhost:4000">marioanton.com</a>
      

      
      </p>
          <!-- Please don't remove this, keep my open source work credited :) -->
    <p class="theme-by text-muted">
      Theme by
      <a href="https://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
    </p>
      </div>
    </div>
  </div>
</footer>

  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
          document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/js/main.js"></script>
    
  


  
  </body>
</html>
